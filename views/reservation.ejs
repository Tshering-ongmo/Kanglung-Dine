<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Make a Reservation | Kanglung Dine</title>
  <link rel="stylesheet" href="/css/styles.css"/>
  <link rel="stylesheet" href="/css/header.css"/>
  <link rel="stylesheet" href="/css/footer.css"/>
  <link rel="stylesheet" href="/css/reservation.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
    <!-- ===== NAVBAR ===== -->
    <%- include('components/header') %>

    <section class="hero-image">
        <img src="/images/reservation.jpg" alt="Table Setup for Reservation" />
        <div class="overlay-text"><h2>Make a Reservation</h2></div>
    </section>
    <div class="reservation-container">
        <form action="/reservations" method="POST" class="reservation-form" id="reservationForm">
            <div class="form-group">
                <label for="restaurant">Restaurant</label>
                <select id="restaurant" name="restaurant" required>
                    <option value="">Select a Restaurant</option>
                    <option value="Kuenga Samdrup">Kuenga Samdrup</option>
                    <option value="Ngawang Choden">Ngawang Choden (NC)</option>
                    <option value="Tashi Delek">Tashi Delek</option>
                    <option value="Apple Bees">Apple Bees</option>
                    <option value="Namsai">Namsai</option>
                </select>
            </div>

            <div class="form-group">
                <label for="date">Date</label>
                <input type="date" id="date" name="date" required>
            </div>

            <div class="form-group">
                <label for="time">Time</label>
                <input type="time" id="time" name="time" required>
            </div>

            <div class="form-group">
                <label for="duration">Duration (hours)</label>
                <select id="duration" name="duration" required>
                    <option value="1">1 hour</option>
                    <option value="2">2 hours</option>
                    <option value="3">3 hours</option>
                </select>
            </div>

            <div class="form-group">
                <label for="number_of_people">Number of People</label>
                <input type="number" id="number_of_people" name="number_of_people" min="1" max="100" required>
            </div>

            <div class="form-group">
                <label for="special_requests">Special Requests (Optional)</label>
                <textarea id="special_requests" name="special_requests" rows="4"></textarea>
            </div>

            <button type="submit">Make Reservation</button>
            <a href="/restaurants"><button type="submit">View restaurants</button></a>
        </form>
    </div>

    <!-- ===== FOOTER ===== -->
    <%- include('components/footer') %>

    <script>
        document.getElementById('reservationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                const response = await fetch('/api/reservations', {  // Changed from /reservations to /api/reservations
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        restaurant: document.getElementById('restaurant').value,
                        date: document.getElementById('date').value,
                        time: document.getElementById('time').value,
                        duration: document.getElementById('duration').value,
                        number_of_people: document.getElementById('number_of_people').value,
                        special_requests: document.getElementById('special_requests').value
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    alert('Reservation made successfully!');
                    window.location.href = '/home';
                } else {
                    alert(data.message || 'Failed to make reservation');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error making reservation. Please try again.');
            }
        });

        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date').min = today;
    </script>
</body>
</html>